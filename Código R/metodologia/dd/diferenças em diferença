#Diretório local de trabalho----

    setwd("C:/Users/igorf/Documents/GitHub/dissertacao/dataset/base")

#Limpando memória----

    rm(list=ls())

#Importando pacotes para trabalho----

    if(!require(dplyr))
        install.packages("dplyr")

    if(!require(stargazer))
        install.packages("stargazer")

    if(!require(plm))
        install.packages("plm")

#Importando base de dados----

    psm <- read.csv("psm.csv",sep=";",dec=".")

#Criando uma dummy para identificação do período de tratamento----
  
    psm <- psm %>%
        mutate(data_treat=if_else(ano>2004,1,0))

    table(psm$data_treat)

#Criando a variável de diff in diff, interagindo polos e data_treat----

    psm <- psm %>%
        mutate(estimador_dd=polos*data_treat)

    table(psm$estimador_dd)

#Declarando que a base de dados é um painel----

    painel <- pdata.frame(psm,index=c("chave","ano"))

    rm(psm)

#Estimando os modelos----

    prod_soja <- plm(prod_soja ~ polos + total.contratos + d.bio + 
                   pib.per.capta + estimador_dd,data=painel,model="pooling")

    ef_prod_soja <- plm(prod_soja ~ polos + total.contratos + d.bio + 
                      pib.per.capta + estimador_dd,data=painel,
                    model="within")
  
    rm_soja <- plm(rm_soja ~ polos + total.contratos + d.bio + 
                 pib.per.capta + estimador_dd,data=painel,model="pooling")

    ef_rm_soja <- plm(rm_soja ~ polos + total.contratos + d.bio + 
                    pib.per.capta + estimador_dd,data=painel,
                  model="within")

    s_soja <- plm(s.soja ~ polos + total.contratos + d.bio + 
                pib.per.capta + estimador_dd,data=painel,model="pooling")

    ef_s_soja <- plm(s.soja ~ polos + total.contratos + d.bio + 
                   pib.per.capta + estimador_dd,data=painel,
                 model="within")

#Exportando tabelas de regressões-----

    stargazer(prod_soja,ef_prod_soja,rm_soja, ef_rm_soja,s_soja,ef_s_soja,
            type="text",omit.stat=c("LL","ser","f"))

#substituindo o ep pelo intervalo de confiança

    stargazer(prod_soja,ea_prod_soja,ef_prod_soja,type="text",ci=TRUE
          ,omit.stat=c("LL","ser","f"))

#Salvando base de dados em painel----

    write.table(painel,file='pnpb_polos.csv',sep=';',dec=".",na="",quote=TRUE, row.names=FALSE)
  
#Teste de LM - efeitos aleatórios vs modelo pooled----
  
    plmtest(prod_soja)
  
#Teste F - efeitos fixos vs modelo pooled----
  
    pFtest(ef_prod_soja,prod_soja)
  
#Teste de Hausman - efeitos aleatórios vs efeitos fixos----
  
    phtest(ea_prod_soja,ef_prod_soja)


#Teste de Breusch-pagan----

    bptest()

#Corrigindo para heterocedasticidade----

    reg_het <- coeftest(reg, vcov.= vcovHC, type = 'HC1)
  
  